<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <!-- 背景 -->
  <rect width="800" height="600" fill="#f5f5f5" rx="10" ry="10"/>
  
  <!-- タイトル -->
  <text x="400" y="40" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">CloudPix メトリクス収集アーキテクチャ</text>
  
  <!-- AWS クラウド枠 -->
  <rect x="50" y="70" width="700" height="480" fill="#ffffff" stroke="#232F3E" stroke-width="2" rx="15" ry="15"/>
  <text x="70" y="100" font-family="Arial" font-size="18" fill="#232F3E">AWS Cloud</text>
  
  <!-- API Gateway -->
  <rect x="100" y="140" width="140" height="70" fill="#DAE8FC" stroke="#6C8EBF" stroke-width="2" rx="5" ry="5"/>
  <text x="170" y="180" font-family="Arial" font-size="14" text-anchor="middle">API Gateway</text>
  
  <!-- Lambda Functions -->
  <rect x="320" y="120" width="160" height="320" fill="#FFE6CC" stroke="#D79B00" stroke-width="2" rx="5" ry="5"/>
  <text x="400" y="150" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Lambda Functions</text>
  
  <!-- Lambda Middleware Stack -->
  <rect x="350" y="170" width="100" height="30" fill="#dae8fc" stroke="#6c8ebf" stroke-width="1" rx="3" ry="3"/>
  <text x="400" y="190" font-family="Arial" font-size="12" text-anchor="middle">Logging Middleware</text>
  
  <rect x="350" y="210" width="100" height="30" fill="#d5e8d4" stroke="#82b366" stroke-width="1" rx="3" ry="3"/>
  <text x="400" y="230" font-family="Arial" font-size="12" text-anchor="middle">Metrics Middleware</text>
  
  <rect x="350" y="250" width="100" height="30" fill="#fff2cc" stroke="#d6b656" stroke-width="1" rx="3" ry="3"/>
  <text x="400" y="270" font-family="Arial" font-size="12" text-anchor="middle">Auth Middleware</text>
  
  <rect x="350" y="290" width="100" height="30" fill="#f8cecc" stroke="#b85450" stroke-width="1" rx="3" ry="3"/>
  <text x="400" y="310" font-family="Arial" font-size="12" text-anchor="middle">Handler</text>
  
  <!-- CloudWatch -->
  <rect x="560" y="140" width="140" height="70" fill="#B3D7FF" stroke="#6C8EBF" stroke-width="2" rx="5" ry="5"/>
  <text x="630" y="180" font-family="Arial" font-size="14" text-anchor="middle">CloudWatch Metrics</text>
  
  <!-- CloudWatch Logs -->
  <rect x="560" y="230" width="140" height="70" fill="#B3D7FF" stroke="#6C8EBF" stroke-width="2" rx="5" ry="5"/>
  <text x="630" y="270" font-family="Arial" font-size="14" text-anchor="middle">CloudWatch Logs</text>
  
  <!-- X-Ray -->
  <rect x="560" y="320" width="140" height="70" fill="#E6FFCC" stroke="#82B366" stroke-width="2" rx="5" ry="5"/>
  <text x="630" y="360" font-family="Arial" font-size="14" text-anchor="middle">AWS X-Ray</text>
  
  <!-- SNS -->
  <rect x="560" y="410" width="140" height="70" fill="#FFE6CC" stroke="#D79B00" stroke-width="2" rx="5" ry="5"/>
  <text x="630" y="450" font-family="Arial" font-size="14" text-anchor="middle">SNS Topic (Alerts)</text>
  
  <!-- DynamoDB -->
  <rect x="100" y="230" width="140" height="70" fill="#E1D5E7" stroke="#9673A6" stroke-width="2" rx="5" ry="5"/>
  <text x="170" y="270" font-family="Arial" font-size="14" text-anchor="middle">DynamoDB</text>
  
  <!-- S3 -->
  <rect x="100" y="320" width="140" height="70" fill="#F8CECC" stroke="#B85450" stroke-width="2" rx="5" ry="5"/>
  <text x="170" y="360" font-family="Arial" font-size="14" text-anchor="middle">S3 Bucket</text>
  
  <!-- ダッシュボード -->
  <rect x="100" y="410" width="140" height="70" fill="#D5E8D4" stroke="#82B366" stroke-width="2" rx="5" ry="5"/>
  <text x="170" y="440" font-family="Arial" font-size="14" text-anchor="middle">CloudWatch</text>
  <text x="170" y="460" font-family="Arial" font-size="14" text-anchor="middle">Dashboard</text>
  
  <!-- 接続線 - Lambda と CloudWatch Metrics -->
  <path d="M 480 225 L 560 175" stroke="#000000" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="520" y="190" font-family="Arial" font-size="10" text-anchor="middle">メトリクス送信</text>
  
  <!-- 接続線 - Lambda と CloudWatch Logs -->
  <path d="M 480 265 L 560 265" stroke="#000000" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="520" y="255" font-family="Arial" font-size="10" text-anchor="middle">ログ出力</text>
  
  <!-- 接続線 - Lambda と X-Ray -->
  <path d="M 480 305 L 560 345" stroke="#000000" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="520" y="315" font-family="Arial" font-size="10" text-anchor="middle">トレース情報</text>
  
  <!-- 接続線 - CloudWatch と SNS -->
  <path d="M 630 300 L 630 410" stroke="#000000" stroke-width="1.5" fill="none" stroke-dasharray="5,5" marker-end="url(#dashedArrow)"/>
  <text x="660" y="355" font-family="Arial" font-size="10" text-anchor="middle">アラート通知</text>
  
  <!-- 接続線 - API Gateway と Lambda -->
  <path d="M 240 175 L 320 175" stroke="#000000" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="280" y="165" font-family="Arial" font-size="10" text-anchor="middle">リクエスト</text>
  
  <!-- 接続線 - Lambda と DynamoDB -->
  <path d="M 320 265 L 240 265" stroke="#000000" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  
  <!-- 接続線 - Lambda と S3 -->
  <path d="M 320 345 L 240 345" stroke="#000000" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  
  <!-- 接続線 - ダッシュボードと CloudWatch -->
  <path d="M 170 410 L 285 330 L 630 330" stroke="#000000" stroke-width="1.5" fill="none" stroke-dasharray="5,5"/>
  <text x="210" y="380" font-family="Arial" font-size="10" text-anchor="middle">可視化</text>
  
  <!-- マーカー定義 -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#000000" />
    </marker>
    <marker id="dashedArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#000000" />
    </marker>
  </defs>
  
  <!-- メトリクスリスト -->
  <rect x="50" y="500" width="700" height="40" fill="#EEEEEE" stroke="#CCCCCC" stroke-width="1" rx="5" ry="5"/>
  <text x="400" y="525" font-family="Arial" font-size="12" text-anchor="middle">
    収集メトリクス: Duration | Errors | Successful | 2xx/4xx/5xx | UserRequests | ProcessingTime | AverageImageProcessingTime
  </text>
</svg>